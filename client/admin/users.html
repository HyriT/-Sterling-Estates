<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Users | Admin Panel</title>
  <link rel="stylesheet" href="admin.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
  <div class="admin-container">
    <aside class="sidebar">
      <div>
        <h2>MC Admin</h2>
         <ul>
  <li><a href="admin.html"><i class="fas fa-tachometer-alt"></i> Dashboard</li>
  <li><a href="appraisals.html"><i class="fas fa-file-signature"></i> Appraisals</a></li>
  <li class="active"><a href="users.html"><i class="fas fa-users"></i> Users</a></li>
        <li ><a href="agent.html"><i class="fas fa-user-tie"></i> Agent</a></li>
  <li><a href="properties.html"><i class="fas fa-building"></i> Properties</a></li>
  <li><i class="fas fa-chart-bar"></i> Statistics</li>
  <li><i class="fas fa-cog"></i> Settings</li>
</ul>
      </div>
      <p style="font-size: 13px;">&copy; 2025 Sterling Estates</p>
    </aside>

    <main class="main-panel">
      <header>
        <h1>Mange Users</h1>
        <div class="admin-user">
          <div class="avatar" onclick="toggleDropdown()">A</div>
          <div class="dropdown" id="profile-dropdown">
            <a href="#">My Profile</a>
            <a href="#" onclick="logout()">Logout</a>
          </div>
        </div>
      </header>
      
      <section class="content-section">
        <div class="controls">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="Search user...">
          </div>
          <!-- <button class="btn btn-primary" onclick="openAddAgentModal()">
            <!-- <i class="fas fa-plus"></i> Add New User -->
          </button> -->
        </div>

      <section class="content-section">
        <table>
          <thead>
            <tr>
              <th>Email</th>
              <th>Username</th>
              <th>Registered Date</th>
              <th>Avatar</th>

            </tr>
          </thead>
          <tbody id="users-table-body"></tbody>
        </table>
      </section>
    </main>
  </div>
<script>
  async function fetchUsers() {
    try {
      const token = localStorage.getItem("token");

      if (!token) {
        alert("Nuk je i loguar! Kthehu te login.");
        window.location.href = "login.html";
        return;
      }

      const res = await fetch("http://localhost:5000/api/user/allUsers", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}` 
        }
      });

      if (!res.ok) {
        if (res.status === 401 || res.status === 403) {
          alert("Nuk ke akses! Kthehu te login.");
          localStorage.removeItem("token");
          window.location.href = "/admin-login.html";
          return;
        }
        throw new Error(`HTTP error! Status: ${res.status}`);
      }

      const data = await res.json();

      const tableBody = document.getElementById("users-table-body");
      tableBody.innerHTML = "";

      data.forEach(user => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${user.email}</td>
          <td>${user.username || "-"}</td>
          <td>${new Date(user.createdAt).toLocaleString()}</td>
          <td><img src="${user.avatar || 'default.png'}" alt="avatar" width="40" height="40"></td>
        `;
        tableBody.appendChild(row);
      });
    } catch (err) {
      console.error("Error fetching users:", err);
    }
  }

  function toggleDropdown() {
    const dropdown = document.getElementById("profile-dropdown");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  }

  function logout() {
    alert("Logging out...");
    localStorage.removeItem("token");
    localStorage.removeItem("user");
    window.location.href = "/admin-login.html";
  }

  window.addEventListener("click", function (e) {
    if (!e.target.closest(".admin-user")) {
      const dropdown = document.getElementById("profile-dropdown");
      if (dropdown) dropdown.style.display = "none";
    }
  });

  document.addEventListener("DOMContentLoaded", fetchUsers);
</script>

</body>
</html>
